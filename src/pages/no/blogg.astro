---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const locale = 'no';

// Fetch all blog posts
const allPosts = await getCollection('blog');

// Filter out drafts and sort by date (newest first)
const posts = allPosts
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Format date helper
function formatDate(date: Date): string {
	return new Intl.DateTimeFormat('no-NO', {
		year: 'numeric',
		month: 'short',
		day: 'numeric',
	}).format(date);
}
---

<BaseLayout
	locale={locale}
	title="Blogg - Quick3 for WooCommerce"
	description="Les våre artikler om Quick3 ERP, WooCommerce-integrasjon, og e-handel. Lær hvordan du kan automatisere nettbutikken din og øke salget."
>
	<Header locale={locale} currentPath={Astro.url.pathname} />

	<div class="bg-white py-24 sm:py-32">
		<div class="mx-auto max-w-7xl px-6 lg:px-8">
			<div class="mx-auto max-w-2xl lg:max-w-4xl">
				<h1 class="text-4xl font-semibold tracking-tight text-pretty text-gray-900 sm:text-5xl">
					Blogg
				</h1>
				<p class="mt-2 text-lg/8 text-gray-600">
					Lær hvordan du kan automatisere nettbutikken din med Quick3 for WooCommerce
				</p>

				{posts.length === 0 ? (
					<div class="mt-16 text-center">
						<p class="text-gray-500">Ingen blogginnlegg ennå. Kom tilbake snart!</p>
					</div>
				) : (
					<div class="mt-16 space-y-20 lg:mt-20">
						{posts.map((post) => (
							<article class="relative isolate flex flex-col gap-8 lg:flex-row">
								<div class="relative aspect-video sm:aspect-2/1 lg:aspect-square lg:w-64 lg:shrink-0">
									<img
										alt={post.data.imageAlt}
										src={post.data.image}
										class="absolute inset-0 size-full rounded-2xl bg-gray-50 object-cover"
									/>
									<div class="absolute inset-0 rounded-2xl inset-ring inset-ring-gray-900/10" />
								</div>
								<div>
									<div class="flex items-center gap-x-4 text-xs">
										<time datetime={post.data.pubDate.toISOString()} class="text-gray-500">
											{formatDate(post.data.pubDate)}
										</time>
									</div>
									<div class="group relative max-w-xl">
										<h2 class="mt-3 text-lg/6 font-semibold text-gray-900 group-hover:text-gray-600">
											<a href={`/no/blogg/${post.slug}`}>
												<span class="absolute inset-0" />
												{post.data.title}
											</a>
										</h2>
										<p class="mt-5 text-sm/6 text-gray-600">{post.data.description}</p>
									</div>
									<div class="mt-6 flex border-t border-gray-900/5 pt-6">
										<div class="relative flex items-center gap-x-4">
											<img alt="" src={post.data.authorImage} class="size-10 rounded-full bg-gray-50" />
											<div class="text-sm/6">
												<p class="font-semibold text-gray-900">
													{post.data.authorName}
												</p>
												<p class="text-gray-600">{post.data.authorRole}</p>
											</div>
										</div>
									</div>
								</div>
							</article>
						))}
					</div>
				)}
			</div>
		</div>
	</div>

	<Footer locale={locale} />
</BaseLayout>
